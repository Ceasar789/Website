<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subjects - Teacher LMS</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

<style>
:root{
  --bg-light:#f4f6fc;
  --bg-dark:#121212;
  --card-bg:#fff;
  --card-hover:#e9f0ff;
  --text-dark:#000;
  --text-light:#fff;
}
body{
  background:var(--bg-light);
  font-family:'Segoe UI',sans-serif;
  transition:all .3s;
  color:var(--text-dark);
}
body.dark{
  background:var(--bg-dark);
  color:var(--text-light);
}
.navbar{box-shadow:0 4px 12px rgba(0,0,0,.08);}
.card-box{
  background:var(--card-bg);
  padding:15px 20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
  margin-bottom:15px;
  transition:.3s;
}
.card-box:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 20px rgba(0,0,0,.1);
  background:var(--card-hover);
}
.subject-title{
  cursor:pointer;
  font-weight:bold;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.subject-details{display:none;margin-top:10px;}
.counter{font-weight:bold;}
</style>
</head>

<body>

<nav class="navbar navbar-dark bg-primary px-4">
  <a class="navbar-brand" href="index.html">Teacher LMS</a>
  <button class="btn btn-outline-light btn-sm ms-auto me-2" onclick="toggleDarkMode()">
    <i class="bi bi-moon-fill"></i>
  </button>
  <button class="btn btn-outline-light btn-sm" onclick="logout()">Logout</button>
</nav>

<div class="container mt-3">
  <button class="btn btn-secondary mb-3" onclick="location.href='dashboard.html'">
    <i class="bi bi-house-door"></i> Back to Home
  </button>
</div>

<div class="container">
  <h3>Subjects <span id="subCount" class="counter">(0)</span></h3>

  <div class="input-group mb-3">
    <input id="subName" class="form-control" placeholder="Subject Name">
    <button class="btn btn-success" onclick="addSubject()">
      <i class="bi bi-plus-circle"></i> Add
    </button>
  </div>

  <div id="subList"></div>
</div>

<script>
function logout(){
  if(confirm("Logout?")) location.href="login.html";
}

function toggleDarkMode(){
  document.body.classList.toggle("dark");
}

/* âœ… UNIVERSAL SUBJECT LOADER (FIX) */
function loadSubjects(){
  const possibleKeys = [
    "subjects",
    "subjectList",
    "teacherSubjects",
    "lmsSubjects"
  ];

  for(let key of possibleKeys){
    try{
      const data = JSON.parse(localStorage.getItem(key));
      if(Array.isArray(data) && data.length > 0){
        console.log("Subjects loaded from:", key);
        return data;
      }
    }catch(e){}
  }
  return [];
}

let subjects = loadSubjects();

const subList  = document.getElementById("subList");
const subCount = document.getElementById("subCount");
const subName  = document.getElementById("subName");

function updateCounter(){
  subCount.textContent = `(${subjects.length})`;
}

function addSubject(){
  if(!subName.value.trim()) return alert("Enter subject name");

  subjects.push({
    n: subName.value.trim(),
    exam:[],
    quiz:[],
    project:[]
  });

  localStorage.setItem("subjects", JSON.stringify(subjects));
  subName.value="";
  renderSubjects();
}

function renderSubjects(){
  subList.innerHTML = "";

  if(subjects.length === 0){
    subList.innerHTML = `<p class="text-muted">No subjects yet.</p>`;
  }

  subjects.forEach((s,i)=>{
    const div = document.createElement("div");
    div.className = "card-box";

    div.innerHTML = `
      <div class="subject-title" onclick="toggleDetails(this)">
        ${s.n}
        <i class="bi bi-chevron-down"></i>
      </div>
      <div class="subject-details">
        <p>Exam: ${s.exam.length}</p>
        <p>Quiz: ${s.quiz.length}</p>
        <p>Project: ${s.project.length}</p>
        <button class="btn btn-danger btn-sm"
          onclick="event.stopPropagation();deleteSubject(${i})">
          Delete
        </button>
      </div>
    `;
    subList.appendChild(div);
  });

  updateCounter();
}

function toggleDetails(el){
  const d = el.nextElementSibling;
  const i = el.querySelector("i");
  const open = d.style.display === "block";
  d.style.display = open ? "none" : "block";
  i.classList.toggle("bi-chevron-up", !open);
  i.classList.toggle("bi-chevron-down", open);
}

function deleteSubject(i){
  subjects.splice(i,1);
  localStorage.setItem("subjects", JSON.stringify(subjects));
  renderSubjects();
}

/* ðŸ” AUTO SYNC ACROSS TABS */
window.addEventListener("storage",()=>{
  subjects = loadSubjects();
  renderSubjects();
});

renderSubjects();
</script>

</body>
</html>
