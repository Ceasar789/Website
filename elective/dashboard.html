<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher LMS</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg-light:#f4f6fc;
  --bg-dark:#121212;
  --text-light:#000;
  --text-dark:#fff;
}
body{background:var(--bg-light);font-family:'Segoe UI',sans-serif;color:var(--text-light);transition:all .3s;}
body.dark{background:var(--bg-dark);color:var(--text-dark);}
.navbar{box-shadow:0 4px 12px rgba(0,0,0,.08);}
.card-box{
  background:#fff;
  padding:20px;
  border-radius:12px;
  margin-bottom:15px;
  transition:all .4s;
  text-align:center;
  opacity:0;
  transform:scale(0.95);
  color:#fff;
}
body.dark .card-box{color:#fff;}
.card-box.show{opacity:1;transform:scale(1);}
.card-box:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 8px 25px rgba(0,0,0,.2);}
.quick-btn{margin-right:10px;transition:all .3s;}
.quick-btn:hover{box-shadow:0 4px 15px rgba(0,0,0,.2);transform:translateY(-2px);}
.progress{height:10px;margin-top:5px;transition:width 1s ease;}
.activity-box{background:#fff;padding:15px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.05);margin-bottom:10px;transition:all .3s;}
input:focus, textarea:focus{outline:none;box-shadow:0 0 6px rgba(13,110,253,.5);}
.gradient-lectures{background:linear-gradient(135deg,#0d6efd,#6610f2);}
.gradient-plans{background:linear-gradient(135deg,#0dcaf0,#198754);}
.gradient-subjects{background:linear-gradient(135deg,#ffc107,#fd7e14);}
.gradient-flash{background:linear-gradient(135deg,#dc3545,#fd7e14);}
</style>
</head>
<body>

<!-- NAV -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary px-4">
<a class="navbar-brand">Teacher LMS</a>
<ul class="navbar-nav ms-auto align-items-center">
<li class="nav-item me-3">
<i class="bi bi-bell-fill" style="font-size:1.2rem;color:#fff;cursor:pointer;" title="Notifications" onclick="showNotifications()"></i>
</li>
<li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
<li class="nav-item ms-3">
<button class="btn btn-outline-light btn-sm px-3" onclick="toggleDarkMode()"><i class="bi bi-moon-fill"></i></button>
</li>
<li class="nav-item ms-3">
<button class="btn btn-outline-light btn-sm px-3" onclick="logout()">Logout</button>
</li>
</ul>
</nav>

<!-- SEARCH BAR -->
<div class="container mt-3">
<div class="input-group mb-3">
<input id="searchDashboard" class="form-control" placeholder="Search Lectures, Lesson Plans, Subjects...">
<button class="btn btn-primary" onclick="searchDashboard()">Search</button>
</div>
</div>

<!-- QUICK ACTION BUTTONS -->
<div class="container mb-4">
<button class="btn btn-success quick-btn" onclick="window.location.href='lectures.html'"><i class="bi bi-journal-plus"></i> Add Lecture</button>
<button class="btn btn-success quick-btn" onclick="window.location.href='lessonplans.html'"><i class="bi bi-book-plus"></i> Add Lesson Plan</button>
<button class="btn btn-success quick-btn" onclick="window.location.href='subjects.html'"><i class="bi bi-grid-plus"></i> Add Subject</button>
<button class="btn btn-success quick-btn" onclick="window.location.href='flashcards.html'"><i class="bi bi-lightbulb"></i> Add Flash Card</button>
</div>

<!-- DASHBOARD CARDS -->
<div class="container mt-2">
<h3>Dashboard</h3>
<div class="row g-3">
  <div class="col-md-3">
    <a class="card-link" href="lectures.html">
      <div class="card-box gradient-lectures" id="cardLectures">
        <i class="bi bi-journal-text" style="font-size:1.5rem;"></i>
        <div>Lectures</div>
        <h2 id="cLectures">0</h2>
        <div class="progress">
          <div class="progress-bar bg-light" id="pLectures" style="width:0%"></div>
        </div>
        <small id="recentLecture"></small>
        <canvas id="chartLectures" height="50"></canvas>
      </div>
    </a>
  </div>
  <div class="col-md-3">
    <a class="card-link" href="lessonplans.html">
      <div class="card-box gradient-plans" id="cardPlans">
        <i class="bi bi-book" style="font-size:1.5rem;"></i>
        <div>Lesson Plans</div>
        <h2 id="cPlans">0</h2>
        <div class="progress">
          <div class="progress-bar bg-light" id="pPlans" style="width:0%"></div>
        </div>
        <small id="recentPlan"></small>
        <canvas id="chartPlans" height="50"></canvas>
      </div>
    </a>
  </div>
  <div class="col-md-3">
    <a class="card-link" href="subjects.html">
      <div class="card-box gradient-subjects" id="cardSubjects">
        <i class="bi bi-grid" style="font-size:1.5rem;"></i>
        <div>Subjects</div>
        <h2 id="cSubjects">0</h2>
        <div class="progress">
          <div class="progress-bar bg-light" id="pSubjects" style="width:0%"></div>
        </div>
        <small id="recentSubject"></small>
        <canvas id="chartSubjects" height="50"></canvas>
      </div>
    </a>
  </div>
  <div class="col-md-3">
    <a class="card-link" href="flashcards.html">
      <div class="card-box gradient-flash" id="cardFlash">
        <i class="bi bi-lightbulb" style="font-size:1.5rem;"></i>
        <div>Flash Cards</div>
        <h2 id="cFlash">0</h2>
        <div class="progress">
          <div class="progress-bar bg-light" id="pFlash" style="width:0%"></div>
        </div>
        <small id="recentFlash"></small>
        <canvas id="chartFlash" height="50"></canvas>
      </div>
    </a>
  </div>
</div>
</div>

<!-- RECENT ACTIVITY -->
<div class="container mt-4">
<h4>Recent Activity</h4>
<div id="activityList">
  <div class="activity-box">No recent activity yet.</div>
</div>
</div>

<script>
function logout(){
  if(confirm("Are you sure you want to logout?")){
    window.location.href = "login.html";
  }
}

/* Dark Mode Toggle */
function toggleDarkMode(){
  document.body.classList.toggle('dark');
}

/* Load counts from localStorage */
let lectures = JSON.parse(localStorage.getItem('lectures')||'[]');
let plans = JSON.parse(localStorage.getItem('plans')||'[]');
let subjects = JSON.parse(localStorage.getItem('subjects')||'[]');
let flash = JSON.parse(localStorage.getItem('flash')||'[]');

document.getElementById('cLectures').innerText = lectures.length;
document.getElementById('cPlans').innerText = plans.length;
document.getElementById('cSubjects').innerText = subjects.length;
document.getElementById('cFlash').innerText = flash.length;

/* Animate cards */
['cardLectures','cardPlans','cardSubjects','cardFlash'].forEach((id,i)=>{
  let el=document.getElementById(id);
  setTimeout(()=>el.classList.add('show'),i*150);
});

/* Animate progress bars */
document.getElementById('pLectures').style.width = Math.min(lectures.length*10,100)+'%';
document.getElementById('pPlans').style.width = Math.min(plans.length*10,100)+'%';
document.getElementById('pSubjects').style.width = Math.min(subjects.length*10,100)+'%';
document.getElementById('pFlash').style.width = Math.min(flash.length*10,100)+'%';

/* Show most recent item */
document.getElementById('recentLecture').innerText = lectures.length ? 'Latest: ' + lectures[lectures.length-1].t : '';
document.getElementById('recentPlan').innerText = plans.length ? 'Latest: ' + plans[plans.length-1].t : '';
document.getElementById('recentSubject').innerText = subjects.length ? 'Latest: ' + subjects[subjects.length-1].n : '';
document.getElementById('recentFlash').innerText = flash.length ? 'Latest: ' + flash[flash.length-1].q : '';

/* Recent activity list */
let activityList = document.getElementById('activityList');
let recentActivities = JSON.parse(localStorage.getItem('recentActivities')||'[]');
if(recentActivities.length){
  activityList.innerHTML='';
  recentActivities.slice(-5).reverse().forEach(a=>{
    let div = document.createElement('div');
    div.className='activity-box';
    div.innerText=a;
    activityList.appendChild(div);
  });
}

/* Dashboard Search */
function searchDashboard(){
  let query = document.getElementById('searchDashboard').value.toLowerCase();
  if(!query) return alert('Enter a search term.');
  let results=[];
  lectures.forEach(l=>{if(l.t.toLowerCase().includes(query)) results.push('Lecture: '+l.t);});
  plans.forEach(p=>{if(p.t.toLowerCase().includes(query)) results.push('Lesson Plan: '+p.t);});
  subjects.forEach(s=>{if(s.n.toLowerCase().includes(query)) results.push('Subject: '+s.n);});
  flash.forEach(f=>{if(f.q.toLowerCase().includes(query)) results.push('Flash Card: '+f.q);});
  if(results.length) alert('Search Results:\n'+results.join('\n'));
  else alert('No results found.');
}

/* Notifications (placeholder) */
function showNotifications(){
  alert('No new notifications.');
}

/* Charts */
function renderChart(id,label,count){
  new Chart(document.getElementById(id),{
    type:'doughnut',
    data:{
      labels:[label,'Remaining'],
      datasets:[{
        data:[count,Math.max(10-count,0)],
        backgroundColor:['rgba(255,255,255,0.8)','rgba(255,255,255,0.3)'],
        borderWidth:0
      }]
    },
    options:{plugins:{legend:{display:false}},cutout:'70%'}
  });
}
renderChart('chartLectures','Lectures',lectures.length);
renderChart('chartPlans','Lesson Plans',plans.length);
renderChart('chartSubjects','Subjects',subjects.length);
renderChart('chartFlash','Flash Cards',flash.length);
</script>

</body>
</html>
